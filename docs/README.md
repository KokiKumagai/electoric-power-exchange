# README

## 必要なクラス

- Account
  - 学生
  - 電力使用量を発行するシステム担当
  - 経理担当
- 配電
  - 電力会社
  - 太陽光
- 取引額
- 残高
- 学生の支払手段
- 購入・売却
- トークン発行
- 月初の使用量計算
- 月末の精算

## Sequenceに必要な主体

- 学生
- システム
- 経理担当
  - 学生経理担当
  - 大学経理掛
- 電力会社
- ソーラーシステム
- XRP Ledger
- Energy Server

## Sequence

### 月初

- システムが使用量を計算
- システムが学生にXRPトークン（電力会社の電気）を発行
- システムが学生にXRPトークン（ソーラーの電気）を発行

### 月中

- 学生が他の学生から電気のXRPトークンを購入する
- システムがXRPトークン（電力会社の電気）を追加発行する
- 取引価格の取引データ（終値など）を表示
- トークン残高を表示
  - 全体の平均、総和の電力使用量表示（電力会社・ソーラー）
  - 学生にのみ、自身の電力使用量を表示
  - 使用量の順位を表示（電力会社・ソーラー）
- 日末、トークン引き落とし

### 月末

- 月末の精算
  - XRPトークンが余っている場合、システムが割引いて学生から購入
    - 割り引かない可能性あり
  - XRPトークンが足りない場合、システムが割増して学生に売却
  - 価格は上記2項目で差し引きゼロになるように調整
    - 価格調整時、システム運用費用を考慮
- 学生経理担当が大学経理掛にデータを提出
- 前年同月比使用量を通知（使用量が多いなど）

### シーケンス図

- Seq1 月初の使用量計算
  - Systemが昨年度同月の使用量から今月の使用量を計算する

- Sew2 月初のトークン発行
  - 学生1はSystemに来月の希望する電気使用量（Solar、電力会社）をリクエストし、SystemはXRPトークンを学生1に送信する
  - SystemはトランザクションをTxDatabaseに記録する

- Seq3 学生間の使用量取引
  - トークンの購入を希望する学生1はSystemに買値と量を登録する
  - トークンの売却を希望する学生2はSystemに売値と量を登録する
  - シングルプライスオークション方式で取引価格と量が決定され、約定価格より高い買い入札と安い売り入札が約定する
  - Systemは約定した取引を実行し、TxDatabaseに記録する

- Seq4 トークンの追加購入
  - 使用量が少なくなった学生1がSystemにトークンの追加を依頼する
  - Systemは学生1にトークンを追加発行する
  - SystemはトランザクションをTxDatabaseに記録する

- Seq5 市場データの取得
  - 学生がTxDatabaseに市場データをリクエストする
  - TxDatabaseは約定価格の日別データをレスポンスする

- Seq6 使用量データの取得
  - 学生がUsageDatabaseに使用量データ（自身・全体）をリクエストする
  - UsageDatabaseは使用量データをレスポンスする
  - 個人データは当月の使用量・残トークン数をレスポンスする
  - 全体データについては平均値・合計値・種類別のランキングをレスポンスする

- Seq7 日別の精算
  - SystemはUsageDatabaseより学生ごとの使用量を取得
  - Systemは所得した使用量に基づいて学生からトークンを回収
  - SystemはトランザクションをTxDatabaseに記録する

- Seq8 月末の精算
  - Systemは学生のトークンの過不足を確認する
  - 足りない学生には割増価格で精算し、余っている学生には割引価格で精算する
  - SystemはトランザクションをTxDatabaseに記録する

- Seq9 経理担当への報告
  - 学生経理担当はUsageDatabaseから使用量を、TxDatabaseから取引履歴と市場での約定価格等を取得する
  - 学生経理担当はこれらを集計し、大学の経理担当に報告する

- Seq10 学生への当月の使用量通知
  - SystemはUsageDatabaseより学生ごとの当月の使用量を取得する
  - Systemは学生ごとに使用量と仕様過多の通知等を送信する
